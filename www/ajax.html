<!DOCTYPE html>

<html>
<head><title>Ajax</title>
<link rel="stylesheet" type="text/css" href="http://bp/styles.css">
</head>

<body>

<h1>AJAX</h1>

<form method="post">
<table width="100%">
	<tr>
		<td align="right">Brukernavn:</td>
		<td align="right" width="30px"><form method="post" target=”_blank”><input type"text" name="bruker" width="30px"></td>

	<tr>
		<td align="right">Passord:</td>
		<td align="right width="30px""><input type="password" name="pass" width="30px"></form></td>
	</tr>

	<tr>
		<td align="right">&nbsp;</td>
		<td align="right width="30px">
			<button type="button" onclick="logIn(bruker.value, pass.value)">Login</button>
			<input type="submit" name="POST" value="Logout"></td>
	</tr>
</table></form>

<table cellspacing="20" width="100%">
	<tr>
		<td>
			Hent en forfatter: <form method="get">
			<input type="text" placeholder="ID" name="forfatterID">
			<button type="button" onclick="getEnForfatter(forfatterID.value)">Hent en</button>
			<button type="button" onclick="loadDoc()">Hent alle</button>
			</form></td>
		<td>
			Hent en bok: <form method="get">
			<input type="text" placeholder="ID" name="bokID">
			<button type="button" onclick="getOneBook(bokID.value)" >Hent en</button>
			<button type="button" onclick="getAllBooks()">Hent alle</button>
			</form></td></tr>
<tr>
		<td>
			 Legg til/endre/slett forfatter: <form method="post">
			<input type="text" placeholder="ID" name="forfatterID">
			<input type="text" placeholder="Fornavn" name="fornavn">
			<input type="text" placeholder="Etternavn" name="etternavn">
			<input type="text" placeholder="NOR" name="najonalitet">
			<input type="submit" value="Legg til" name="POST">
			<input type="submit" value="Endre" name="PUT">
			<input type="submit" value="Slett" name="DELETE">
			<input type="submit" value="Slett alle" name="DELETEALL">
			</form></td>
<td>
			Legg til/endre/slett bok: <form method="post">
			<input type="text" placeholder="BokID" name="bokID">
			<input type="text" placeholder="Tittel" name="tittel">
			<input type="text" placeholder="ForfatterID" name="forfatterID">
			<input type="submit" value="Legg til" name="POST">
			<input type="submit" value="Endre" name="PUT">
			<input type="submit" value="Slett" name="DELETE">
			<input type="submit" value="Slett alle" name="DELETEALL">
</form></td></tr>
<tr>
	<td><table id="demo" width="100%"></table></td>
	<td>&nbsp;</td>
</tr></table>


<!-- Ajax functions -->

<script>

<!-- Alle forfattere -->

function loadDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      myFunction(this);
    }
  };
  xhttp.open("GET", "http://bp:8888/forfatter/", true);
  xhttp.send();
}
function myFunction(xml) {
  var i;
  var xmlDoc = xml.responseXML;
  var table="<tr><th>ForfatterID</th><th>Fornavn</th><th>Etternavn</th><th>Najonalitet</th></tr>";
  var x = xmlDoc.getElementsByTagName("forfatter");
  for (i = 0; i <x.length; i++) { 
    table += "<tr><td>" +
    x[i].getElementsByTagName("forfatterid")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("fornavn")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("etternavn")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("nasjonalitet")[0].childNodes[0].nodeValue +
    "</td></tr>";
  }	
  document.getElementById("demo").innerHTML = table;
}

<!-- En forfatter -->

function getEnForfatter(forfatterId) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      myFunction(this);
    }
  };
  xhttp.open("GET", "http://bp:8888/forfatter/"+forfatterId, true);
  xhttp.send();
}
function myFunction(xml) {
  var i;
  var xmlDoc = xml.responseXML;
  var table="<tr><th>ForfatterID</th><th>Fornavn</th><th>Etternavn</th><th>Najonalitet</th></tr>";
  var x = xmlDoc.getElementsByTagName("forfatter");
  for (i = 0; i <x.length; i++) { 
    table += "<tr><td>" +
    x[i].getElementsByTagName("forfatterid")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("fornavn")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("etternavn")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("nasjonalitet")[0].childNodes[0].nodeValue +
    "</td></tr>";
  }	
  document.getElementById("demo").innerHTML = table;
}


<!-- Alle boker -->

function getAllBooks() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      boktabell(this);
    }
  };
  xhttp.open("GET", "http://bp:8888/bok/", true);
  xhttp.send();
}
function boktabell(xml) {
  var i;
  var xmlDoc = xml.responseXML;
  var table="<tr><th>BokId</th><th>Tittel</th><th>ForfatterId</th>";
  var x = xmlDoc.getElementsByTagName("bok");
  for (i = 0; i <x.length; i++) { 
    table += "<tr><td>" +
    x[i].getElementsByTagName("bokid")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("tittel")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("forfatterid")[0].childNodes[0].nodeValue +
    "</td></tr>";
  }	
  document.getElementById("demo").innerHTML = table;
}


<!-- En bok -->

function getOneBook(bokId) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      boktabell(this);
    }
  };
  xhttp.open("GET", "http://bp:8888/bok/"+bokId, true);
  xhttp.send();
}
function boktabell(xml) {
  var i;
  var xmlDoc = xml.responseXML;
  var table="<tr><th>BokId</th><th>Tittel</th><th>ForfatterId</th>";
  var x = xmlDoc.getElementsByTagName("bok");
  for (i = 0; i <x.length; i++) { 
    table += "<tr><td>" +
    x[i].getElementsByTagName("bokid")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("tittel")[0].childNodes[0].nodeValue +
    "</td><td>" +
    x[i].getElementsByTagName("forfatterid")[0].childNodes[0].nodeValue +
    "</td></tr>";
  }	
  document.getElementById("demo").innerHTML = table;
}


<!-- Login -->

function logIn(bNavn, pass){
  var passHash = parseInt(md5(pass));
  console.log("Bruker = "+bNavn);
  console.log("Password hash= "+passHash);
  var xhhtp = new XMLHttpRequest();
  var xml="<?xml version="1.0" encoding="UTF-8"?><login><brukernavn>"+bNavn+"</brukernavn><passord>"+passHash+"</passord></login>";
  xhttp.onreadystatechange = funciton() {
    if (this.readyState == 4 && this.status == 200) {
      logon(this);
    }
  };
  xhttp.setRequestHeader("Content-Type", "text/xml" );
  xhttp.open("POST", "http://bp:8888/login/", true);
  xhttp.send(xml)
}
function logon(cookie){
 console.log("Få tilbake og sette cookie her!" + cookie);
}
</script>

</body>
</html>	
